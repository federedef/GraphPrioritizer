<%
        def order_columns(name, column)
                tab_header = @hash_vars[name].shift
                @hash_vars[name].sort!{|s1, s2| s1[column] <=> s2[column] }
                @hash_vars[name].unshift(tab_header)
        end

        if !@hash_vars['parsed_non_integrated_rank_summary'].nil?
                order_columns('parsed_non_integrated_rank_summary',0)
        end

        if !@hash_vars['parsed_integrated_rank_summary'].nil?
                order_columns('parsed_integrated_rank_summary',0)
        end

        if !@hash_vars['parsed_non_integrated_rank_pos_cov'].nil?
                order_columns('parsed_non_integrated_rank_pos_cov',0)
        end

        if !@hash_vars['parsed_integrated_rank_pos_cov'].nil?
                order_columns('parsed_integrated_rank_pos_cov',0)
        end

        if !@hash_vars['parsed_annotation_grade_metrics'].nil?
                order_columns('parsed_annotation_grade_metrics',0)
        end
         img_path="/mnt/scratch/users/bio_267_uma/federogc/executions/backupgenes/report/img/"
        
%>


<div style="width:90%; background-color:#FFFFFF; margin:50 auto; align-content: center;">
        <h1 style="text-align:center; background-color:#ecf0f1, color: powderblue; "> Analysis of the algorithm: From rankings to backup genes.</h1>

        <h2 style="text-align:center; background-color:#ecf0f1, color: powderblue;"> Ranking section </h2>

        <div style="overflow: hidden";>
                <p style="text-align:center;"><b>Table 1.</b> Performance summary for every kernel and net before integration.</p> 
                <%= 
                if !@hash_vars['parsed_non_integrated_rank_summary'].nil?
                        table(id: "parsed_non_integrated_rank_summary", text: true, header: true, 
                                fields: [1,2,3,4,5,6,12],
                                cell_align: ['left', 'center', 'center', 'center','center','center','center'],
                                border: 2,
                                attrib: {
                                        'style' => 'margin-left: auto; margin-right:auto;',
                                        'cellspacing' => 0,
                                        'cellpadding' => 2
                                }) do |data|
                        end
                end
                %>
        </div>

        <div style="overflow: hidden";>
                <p style="text-align:center;"><b>Table 2.</b> Performance summary for every kernel after integration</p> 
                <%=
                if !@hash_vars['parsed_integrated_rank_summary'].nil? 
                        table(id: "parsed_integrated_rank_summary", text: true, header: true, 
                                fields: [1,2,3,4,5,6,12],
                                cell_align: ['left', 'center', 'center', 'center','center','center','center'],
                                border: 2,
                                attrib: {
                                        'style' => 'margin-left: auto; margin-right:auto;',
                                        'cellspacing' => 0,
                                        'cellpadding' => 2
                                }) do |data|
                        end
                end
                %>
        </div>

        <div style="overflow: hidden";>
                <p style="text-align:center;"><b>Backup Pairs Coverage By Layer Non integrated</b></p> 
                <%=
                if !@hash_vars['parsed_non_integrated_rank_pos_cov'].nil? 
                        barplot(id: "parsed_non_integrated_rank_pos_cov", fields: [2,4] , header: true, responsive: false,
                                height: '400px', width: '400px', x_label: 'Number of Backup pairs present', smp_attr: [1,2],
                                title: "Backup Pairs Coverage By Layer",
                                config: {
                                        'showLegend' => true,
                                        'graphOrientation' => 'horizontal',
                                        'colorBy' => 'Sample'
                                        })
                end
                %>
        </div>

        <div style="overflow: hidden";>
                <p style="text-align:center;"><b>Backup Pairs Coverage By Layer Integrated</b></p> 
                <%=
                if !@hash_vars['parsed_integrated_rank_pos_cov'].nil? 
                        barplot(id: "parsed_integrated_rank_pos_cov", fields: [1,3] , header: true, responsive: false,
                                height: '400px', width: '400px', x_label: 'Number of Backup pairs present', smp_attr: [1,2],
                                title: "Backup Pairs Coverage By Layer",
                                config: {
                                        'showLegend' => true,
                                        'graphOrientation' => 'horizontal',
                                        'colorBy' => 'Kernel'
                                        })
                end
                %>
        </div>

         <div style="overflow: hidden";>
                <p style="text-align:center;"><b>Distribution of ranks in dataset by non integrated kernels</b></p> 
                <%=boxplot(id: 'non_integrated_rank_cdf', header: true, row_names: false, default: false, smp_attr: [2], group: ["kernel"],
                           title: "Distribution of non zero ranks in dataset by Non Integrated kernels",
                                xlabel: "Ranks",
                                config: {"xAxis" => "rank",
                                        "graphOrientation": "vertical",
                                        "colorBy" => "kernel",
                                        "groupingFactors" =>
                                        ["kernel"]}

                        )
                        %>
        </div>


        <div style="overflow: hidden";>
                <p style="text-align:center;"><b>Distribution of ranks in dataset by Integrated kernels</b></p> 
                <%=boxplot(id: 'integrated_rank_cdf', header: true, row_names: false, default: false, smp_attr: [2], group: ["kernel"], 
                                title: "Distribution of non zero ranks in dataset by Integrated kernels",
                                xlabel: "Ranks",
                                config: {"xAxis" => "rank",
                                        "graphOrientation": "vertical",
                                        "colorBy" => "kernel",
                                        "groupingFactors" =>
                                        ["kernel"]}

                        )
                        %>
        </div>

        <h3 style="text-align:center; background-color:#ecf0f1, color: powderblue;">  </h3>

        <div style="overflow: hidden">
                <p style="text-align:center;"> ROC-AUCs for Non-integrated kernel and layer </p> 

                <%= 
                if !@hash_vars['parsed_non_integrated_rank_summary'].nil? 
                        line(id: "parsed_non_integrated_rank_summary", fields: [0, 7, 13, 8], header: true, row_names: true,
                                responsive: false,
                                height: '400px', width: '400px', x_label: 'Percentile',
                                title: "Distribution of AUC in bootstrap for non integrated kernels",
                                config: {
                                        'showLegend' => true,
                                        'graphOrientation' => 'vertical',
                                        })
                end
                %>

        </div>

        <div style="overflow: hidden">
                <p style="text-align:center;"> ROC-AUCS for integrated kernels </p> 

                <%=
                if !@hash_vars['parsed_integrated_rank_summary'].nil?
                        line(id: "parsed_integrated_rank_summary", fields:  [0, 7, 13, 8], header: true, row_names: true,
                                responsive: false,
                                height: '400px', width: '400px', x_label: 'Percentile',
                                title: "Distribution of AUC in bootstrap for integrated kernels",
                                config: {
                                        'showLegend' => true,
                                        'graphOrientation' => 'vertical',
                                        })
                end
                %>
        </div>
      

        <div style="overflow: hidden";>
                <p style="text-align:center;"> CDF plots of non integrated kernels </p> 
                <%= 
                if !@hash_vars['non_integrated_rank_cdf'].nil?
                       scatter2D(id: "non_integrated_rank_cdf", fields: [5,6] , header: true, row_names: false, responsive: false,
                                height: '400px', width: '400px', x_label: 'percentiles', smp_attr: [0,1,2],
                                title: "cummulative distribution of non zero scores function plot",
                                config: {
                                        'showLegend' => true,
                                        'lineBy' => 'kernel',
                                        'colorBy' => 'kernel',
                                        'segregateVariablesBy' => 'annot'
                                        })
                end
                %>
        </div>

       <div style="overflow: hidden; text-align:center">
                <p style="text-align:center;"> ROC plots of non integrated kernels </p> 
                <%= 
                        embed_img(img_path+"non_integrated_ROC.png","width='700' height='700'")
                %>
        </div>

        <div style="overflow: hidden; text-align:center">
                <p style="text-align:center;"> ROC plots of integrated kernels </p> 
                <%= 
                if File.exist?(img_path+"integrated_ROC.png")
                        embed_img(img_path+"integrated_ROC.png","width='700' height='700'")
                end
                %>
        </div>

        <div style="overflow: hidden";>
                <p style="text-align:center;"> CDF plots of integrated kernels </p> 
                <%= 
                if !@hash_vars['integrated_rank_cdf'].nil?
                       scatter2D(id: "integrated_rank_cdf", fields: [5,6] , header: true, row_names: false, responsive: false,
                                height: '400px', width: '400px', x_label: 'percentiles', smp_attr: [0,1,2],
                                title: "cummulative distribution of non zero scores function plot",
                                config: {
                                        'showLegend' => true,
                                        'lineBy' => 'kernel',
                                        'colorBy' => 'kernel',
                                        'segregateVariablesBy' => 'integration'
                                        })
                end
                %>
        </div>

</div>


















